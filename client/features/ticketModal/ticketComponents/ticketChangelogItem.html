<template name="ticketChangelogItem">
  {{#if note}}
    <div class="columns">
      <div class="column is-4-mobile is-2-desktop">
        <label for="note-{{_id}}" class="control-label pull-right">
            {{#if authorId}}
                {{> userPortrait userId=authorId}}
            {{else}}
                {{authorEmail}} (via e-mail)
            {{/if}}
          <small style="font-size: 0.7em; font-weight: lighter;">{{>timeFromNow date=timestamp}}</small>
        </label>
      </div>
      <div class="column is-8-mobile is-10-desktop">
        <div class="box {{internalNoteClass}}" style="text-align: left;">
          {{#each noteParagraph}}
            <p>{{linkify this}}</p>
          {{/each}}
          {{#if internal}}<span class="glyphicon glyphicon-lock pull-right" title="This note is only visible to queue members."></span>{{/if}}
        </div>
        </div>
      </div>
      {{else}}
      <div class="columns">
          <div class="column is-8-mobile is-offset-4-mobile is-10-desktop is-offset-2-desktop">
          {{#if changeIsType 'attachment'}}
            {{#with otherId}}
              {{#if file.thumbnail}}
                <a class="cursor-pointer" data-action="showAttachmentModal" data-fileId="{{file._id}}">
                  <img class="img-thumbnail" style="max-width: 100%; max-height: 128px" src="/file/{{file.thumbnail}}"/><br/>
                </a>
              {{/if}}
            {{/with}}
          {{/if}}
          <small style="font-size: 0.7em;">
            {{#if changeIsType 'attachment'}}
              {{#if oldValue}}
                User {{authorName}} removed attached file {{oldValue}}
              {{/if}}
              {{#if newValue}}
                User {{authorName}} attached file {{newValue}}
              {{/if}}
            {{/if}}
            {{#if changeIsType 'field'}}
              {{#if fieldIs 'queueName'}}
                User {{authorName}} transferred ticket from {{oldValue}} to {{newValue}}
              {{/if}}
              {{#if fieldIs 'status'}}
                User {{authorName}} changed status from {{oldValue}} to {{newValue}}
              {{/if}}

              {{#if fieldIs 'tags'}}
                {{#if oldValue}}
                  User {{authorName}} removed tag(s) {{oldValue}}
                {{/if}}
                {{#if newValue}}
                  User {{authorName}} added tag(s) {{newValue}}
                {{/if}}
              {{/if}}

              {{#if fieldIs 'associatedUserIds'}}
                {{#if oldValue}}
                  User {{authorName}} removed associated user(s) {{oldValue}}
                {{/if}}
                {{#if newValue}}
                  User {{authorName}} associated user(s) {{newValue}}
                {{/if}}
              {{/if}}
            {{/if}}
            @ {{timestamp}}
          </small>
        </div>
      </div>
    {{/if}}
</template>
